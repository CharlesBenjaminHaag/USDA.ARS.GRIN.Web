@model USDA.ARS.GRIN.Web.ViewModelLayer.PVPApplicationViewModel
@{
    ViewBag.Title = "Index";
    Layout = "~/Views/Shared/_LayoutInterior.cshtml";
}

<style>
    #overlay {
        height: 100%;
        width: 100%;
        position: fixed; /* NOTE: Had originally been "absolute;" overlay did not conceal entire page and allowed scrolling behind it. */
        top: 0px;
        left: 0px;
        z-index: 99999;
        background-color: #1b1b1b;
        color: white;
        filter: alpha(opacity=75);
        -moz-opacity: 0.75;
        opacity: 0.75;
        display: none;
        overflow: scroll;
    }

        #overlay h2 {
            position: fixed;
            margin-left: 40%;
            top: 40%;
        }
</style>

<div id="overlay"><h2>Loading .. Please wait</h2></div>
<div class="grid-container">
    <div class="grid-row grid-gap">
        <div class="usa-layout-docs__sidenav desktop:grid-col-2">
            <nav aria-label="Secondary navigation">
                <form class="usa-search usa-search--small" role="search">
                    <label class="usa-sr-only" for="search-field-en-small">Search</label>
                    <input class="usa-input" id="search-field-en-small" type="search" name="search" placeholder="Search GRIN-Global">
                    <button class="usa-button" type="submit">
                        <span class="usa-sr-only">Search</span>
                    </button>
                </form>
                @*<br />*@
                <ul class="usa-sidenav">
                    <li class="usa-sidenav__item">
                        <a href="/">Home</a>
                    </li>
                    <li class="usa-sidenav__item">
                        <a href="" class="usa-current">Overview</a>
                        <ul class="usa-sidenav__sublist">

                            <li class="usa-sidenav__item">
                                <a href="@Url.Action("Search","PVP")">Advanced Search</a>
                            </li>
                            @*<li class="usa-sidenav__item">
                                    <a href="@Url.Action("Contact","Home", new { topic = "PVP" })">Report a Problem</a>
                                </li>*@
                        </ul>
                    </li>
                    <li style="margin-top:20px;">
                        <h4 style="font-weight:bold;">Filter by Status</h4>
                        <div class="usa-checkbox">
                            <input class="usa-checkbox__input usa-checkbox__input--tile status-selector"
                                   id="check-application-pending"
                                   type="checkbox"
                                   name="historical-figures-2"
                                   value="frederick-douglass" />
                            <label class="usa-checkbox__label" for="check-application-pending">Application Pending</label>
                        </div>
                        <div class="usa-checkbox">
                            <input class="usa-checkbox__input usa-checkbox__input--tile status-selector"
                                   id="check-certificate-issued"
                                   type="checkbox"
                                   name="historical-figures-2"
                                   value="frederick-douglass" />
                            <label class="usa-checkbox__label" for="check-certificate-issued">Certificate Issued</label>
                        </div>
                        <div class="usa-checkbox">
                            <input class="usa-checkbox__input usa-checkbox__input--tile status-selector"
                                   id="check-certificate-expired"
                                   type="checkbox"
                                   name="historical-figures-2"
                                   value="booker-t-washington" />
                            <label class="usa-checkbox__label" for="check-certificate-expired">Certificate Expired</label>
                        </div>
                    </li>
                </ul>
            </nav>
        </div>
        <main class="usa-layout-docs__main desktop:grid-col-9 usa-prose usa-layout-docs" id="main-content">
            @*<p class="usa-intro">
                GRIN both provides data, and compiles references to databases hosted by collaborating projects.
                </p>*@
            <h2 id="section-heading-h2">Overview</h2>
            <p>
                This collection is maintained in conjunction with the Agricultural Marketing Service Plant Variety Protection Office (PVPO), which provides intellectual property protection to breeders. This office publishes monthly updates to the status of PVP certificates.
            </p>
            <h3 id="section-heading-h2">Browse PVP Applications</h3>
            <div class="usa-alert usa-alert--info usa-alert--slim">
                <div class="usa-alert__body">
                    <p class="usa-alert__text">
                        Last updated: 9/19/2022 <a class="usa-link" href="javascript:void(0);">consectetur adipiscing</a>
                        elit, sed do eiusmod.
                    </p>
                </div>
            </div>
            <div class="grid-container margin-2">
                <div class="grid-row grid-gap">
                    <div id="section-filter-by-time-frame" class="grid-col-12">
                        <ul class="usa-button-group usa-button-group--segmented" style="padding-left:0px;">
                            <li class="usa-button-group__item">
                                <button id="btn-expired" title="expired" class="usa-button">This Week</button>
                            </li>
                            <li class="usa-button-group__item">
                                <button id="btn-submitted" title="submitted" class="usa-button usa-button--outline">This Month</button>
                            </li>
                            <li class="usa-button-group__item">
                                <button id="btn-expiring" title="expiring" class="usa-button usa-button--outline">The Last 6 Months</button>
                            </li>
                            <li class="usa-button-group__item">
                                <button id="btn-expiring" title="expiring" class="usa-button usa-button--outline">The Last Year</button>
                            </li>
                        </ul>
                        <div id="section-pvp_applications" style="margin-top:20px;">
                            @{ Html.RenderAction("_List", "PVP");}
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>
</div>

<div id="modal-pvp-detail" class="modal" tabindex="-1" role="dialog">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">
                    <span id="site-name">TEST</span>
                </h3>

            </div>
            <div class="modal-body">
                <table class="usa-table usa-table--borderless">
                    
                    
                    <tbody>                        <tr>
                            <th scope="row" style="font-weight:bold;">PI Number</th>
                            <td>
                                12345
                            </td>
                            <td>1776</td>
                        </tr>
                        <tr>
                            <th scope="row">Applicant</th>
                            <td>
                                The first ten amendments of the U.S. Constitution guaranteeing rights
                                and freedoms.
                            </td>
                            <td>1791</td>
                        </tr>
                        <tr>
                            <th scope="row">Declaration of Sentiments</th>
                            <td>
                                A document written during the Seneca Falls Convention outlining the
                                rights that American women should be entitled to as citizens.
                            </td>
                            <td>1848</td>
                        </tr>
                        <tr>
                            <th scope="row">Emancipation Proclamation</th>
                            <td>
                                An executive order granting freedom to slaves in designated southern
                                states.
                            </td>
                            <td>1863</td>
                        </tr>
                    </tbody>
                </table>


            </div>

            <div class="modal-footer">
                <button type="button" class="btn btn-primary" data-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>

<script type="text/javascript">
    $(document).ready(function () {
        /*LoadData("expired");*/
    });

    /*========================================================================================
    * STATUS SELECTORS
    *========================================================================================
    */
    $(".status-selector").click(function () {
        LoadData("test");
    });

    function GetSelectedStatuses() {
        var valueArray = [];
        $("#section-filter-by-status input:checked").each(function () {
            var id = $(this).attr("id");
            valueArray.push(id);
        });
        return valueArray;
    }

    $(function () {
        $('.usa-button-group__item button').on('click', function () {
            var context = $(this).attr("title");

            $('.usa-button-group__item button').addClass('usa-button--outline');
            $(this).removeClass('usa-button--outline');
            LoadData(context);
        });
    });

    $(function () {
        $('.pvp-detail-btn').on('click', function () {
            var id = this.id;
            $('.usa-button-group__item button').addClass('usa-button--outline');
            $(this).removeClass('usa-button--outline');
            LoadData(context);
        });
    });

    function LoadData(context)
    {
        $("#overlay").show();
        var link = '@Url.Action("_List", "PVP")';
        var selectedStatusList = GetSelectedStatuses();
        var selectedTimeFrame = context;

        var formData = new FormData();
        formData.append("StatusList", selectedStatusList);
        formData.append("TimeFrame", context);

        $.ajax({
            url: link,
            type: 'POST',
            cache: false,
            contentType: false,
            processData: false,
            data: formData,
            success: function (response) {
                $("#section-data").html(response);
            }
        });
        $("#overlay").hide();

        //$.ajax(
        //    {
        //        type: 'POST',
        //        url: link,
        //        data: formData,
        //        success:
        //            function (response) {
        //                $("#section-data").html(response);
        //                $('#table_id').DataTable({
        //                    responsive: true,
        //                    select: true
        //                });
        //                $("#overlay").hide();
        //            },
        //        error:
        //            function (response) {
        //                console.log(response);
        //                $("#overlay").hide();
        //            }
        //    });
    }

    /* DETAIL */
    $(function () {
        $('.detail-expand').on('click', function () {
            var id = this.id;
            $("#modal-pvp-detail").modal("show");
        });
    });
</script>
